<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>

    <title>backbone.paginator server mode demo</title>

    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/bootstrap-theme.css"/>
    <link rel="stylesheet" href="css/backgrid.css"/>
    <link rel="stylesheet" href="css/extensions/paginator/backgrid-paginator.css"/>
    <link rel="stylesheet" href="css/extensions/text-cell/backgrid-text-cell.css"/>

</head>
<body>
<div id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="grid"></div>
                <div id="paginator"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="js/underscore-min.js"></script>
<script src="js/backbone-min.js"></script>
<script src="js/backbone.paginator.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/backgrid.min.js"></script>
<script src="js/extensions/paginator/backgrid-paginator.js"></script>
<script src="js/extensions/text-cell/backgrid-text-cell.js"></script>
<script>
    var Wave = Backbone.Model.extend(
            /** @lends Wave.prototype */
            {
                defaults: {
                    title: '',
                    userIds: [],
                    current: false
                },
                idAttribute: '_id',
                initialize: function () {
                    Backbone.Model.prototype.initialize.apply(this, arguments);
                    this.on("change", function (model, options) {
                        if (options && options.save === false) return;
                        model.save();
                    });
                }
            });

    var Waves = Backbone.PageableCollection.extend({

        url: "/api/wave",

        // Initial pagination states
        state: {
            pageSize: 10
            /*sortKey: "updated",
             order: 1*/
        },

        // You can remap the query parameters from `state` keys from
        // the default to those your server supports
        queryParams: {
            totalPages: null,
            totalRecords: null,
            sortKey: "sort"
            /*q: "state:closed repo:jashkenas/backbone"*/
        },

        parseState: function (resp, queryParams, state, options) {
            return {totalRecords: resp.total_count};
        },

        parseRecords: function (resp, options) {
            return resp.items;
        },

        model: Wave
    });

    var waves = new Waves();

    var grid = new Backgrid.Grid({
        columns: [{
            name: "_id",
            cell: "string",
            sortable: true,
            editable: false
        }, {
            name: "title",
            cell: "string",
            sortable: true,
            editable: true
        }, {
            name: "userIds",
            cell: "string",
            sortable: false
        }],

        collection: waves
    });

    var paginator = new Backgrid.Extension.Paginator({
        collection: waves
    });

    $("#grid").append(grid.render().$el);
    $("#paginator").append(paginator.render().$el);

    waves.fetch({reset: true});
</script>
</body>
</html>
