function strip_tags(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}function nl2br(a,b){var c=b||"undefined"==typeof b?"<br />":"<br>";return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+c+"$2")}function wordwrap(a){var b,c,d,e,f,g=arguments.length>=2?arguments[1]:75,h=arguments.length>=3?arguments[2]:"\n",i=arguments.length>=4?arguments[3]:!1;if(a+="",1>g)return a;for(b=-1,d=(f=a.split(/\r\n|\n|\r/)).length;++b<d;f[b]+=e)for(e=f[b],f[b]="";e.length>g;f[b]+=e.slice(0,c)+((e=e.slice(c)).length?h:""))c=2==i||(c=e.slice(0,g+1).match(/\S*(\s)?$/))[1]?g:c.input.length-c[0].length||1==i&&g||c.input.length+(c=e.slice(g).match(/^\S*/))[0].length;return f.join("\n")}!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.io=a():"undefined"!=typeof global?global.io=a():"undefined"!=typeof self&&(self.io=a())}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=a("./lib/")},{"./lib/":2}],2:[function(a,b,c){function d(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d=e(a),f=d.source,j=d.id;return b.forceNew||b["force new connection"]||!1===b.multiplex?(h("ignoring socket cache for %s",f),c=g(f,b)):(i[j]||(h("new io instance for %s",f),i[j]=g(f,b)),c=i[j]),c.socket(d.path)}var e=a("./url"),f=a("socket.io-parser"),g=a("./manager"),h=a("debug")("socket.io-client");b.exports=c=d;var i=c.managers={};c.protocol=f.protocol,c.connect=d,c.Manager=a("./manager"),c.Socket=a("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:9,"socket.io-parser":40}],3:[function(a,b){function c(a,b){return this instanceof c?(a&&"object"==typeof a&&(b=a,a=void 0),b=b||{},b.path=b.path||"/socket.io",this.nsps={},this.subs=[],this.opts=b,this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.timeout(null==b.timeout?2e4:b.timeout),this.readyState="closed",this.uri=a,this.connected=0,this.attempts=0,this.encoding=!1,this.packetBuffer=[],this.encoder=new g.Encoder,this.decoder=new g.Decoder,void this.open()):new c(a,b)}var d=(a("./url"),a("engine.io-client")),e=a("./socket"),f=a("component-emitter"),g=a("socket.io-parser"),h=a("./on"),i=a("component-bind"),j=(a("object-component"),a("debug")("socket.io-client:manager"));b.exports=c,c.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)this.nsps[a].emit.apply(this.nsps[a],arguments)},f(c.prototype),c.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection},c.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts},c.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this):this._reconnectionDelay},c.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this):this._reconnectionDelayMax},c.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout},c.prototype.maybeReconnectOnOpen=function(){this.openReconnect||this.reconnecting||!this._reconnection||(this.openReconnect=!0,this.reconnect())},c.prototype.open=c.prototype.connect=function(a){if(j("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;j("opening %s",this.uri),this.engine=d(this.uri,this.opts);var b=this.engine,c=this;this.readyState="opening";var e=h(b,"open",function(){c.onopen(),a&&a()}),f=h(b,"error",function(b){if(j("connect_error"),c.cleanup(),c.readyState="closed",c.emitAll("connect_error",b),a){var d=new Error("Connection error");d.data=b,a(d)}c.maybeReconnectOnOpen()});if(!1!==this._timeout){var g=this._timeout;j("connect attempt will timeout after %d",g);var i=setTimeout(function(){j("connect attempt timed out after %d",g),e.destroy(),b.close(),b.emit("error","timeout"),c.emitAll("connect_timeout",g)},g);this.subs.push({destroy:function(){clearTimeout(i)}})}return this.subs.push(e),this.subs.push(f),this},c.prototype.onopen=function(){j("open"),this.cleanup(),this.readyState="open",this.emit("open");var a=this.engine;this.subs.push(h(a,"data",i(this,"ondata"))),this.subs.push(h(this.decoder,"decoded",i(this,"ondecoded"))),this.subs.push(h(a,"error",i(this,"onerror"))),this.subs.push(h(a,"close",i(this,"onclose")))},c.prototype.ondata=function(a){this.decoder.add(a)},c.prototype.ondecoded=function(a){this.emit("packet",a)},c.prototype.onerror=function(a){j("error",a),this.emitAll("error",a)},c.prototype.socket=function(a){var b=this.nsps[a];if(!b){b=new e(this,a),this.nsps[a]=b;var c=this;b.on("connect",function(){c.connected++})}return b},c.prototype.destroy=function(){--this.connected||this.close()},c.prototype.packet=function(a){j("writing packet %j",a);var b=this;b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(a){for(var c=0;c<a.length;c++)b.engine.write(a[c]);b.encoding=!1,b.processPacketQueue()}))},c.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}},c.prototype.cleanup=function(){for(var a;a=this.subs.shift();)a.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},c.prototype.close=c.prototype.disconnect=function(){this.skipReconnect=!0,this.engine.close()},c.prototype.onclose=function(a){j("close"),this.cleanup(),this.readyState="closed",this.emit("close",a),this._reconnection&&!this.skipReconnect&&this.reconnect()},c.prototype.reconnect=function(){if(this.reconnecting)return this;var a=this;if(this.attempts++,this.attempts>this._reconnectionAttempts)j("reconnect failed"),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.attempts*this.reconnectionDelay();b=Math.min(b,this.reconnectionDelayMax()),j("will wait %dms before reconnect attempt",b),this.reconnecting=!0;var c=setTimeout(function(){j("attempting reconnect"),a.emitAll("reconnect_attempt",a.attempts),a.emitAll("reconnecting",a.attempts),a.open(function(b){b?(j("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(j("reconnect success"),a.onreconnect())})},b);this.subs.push({destroy:function(){clearTimeout(c)}})}},c.prototype.onreconnect=function(){var a=this.attempts;this.attempts=0,this.reconnecting=!1,this.emitAll("reconnect",a)}},{"./on":4,"./socket":5,"./url":6,"component-bind":7,"component-emitter":8,debug:9,"engine.io-client":11,"object-component":37,"socket.io-parser":40}],4:[function(a,b){function c(a,b,c){return a.on(b,c),{destroy:function(){a.removeListener(b,c)}}}b.exports=c},{}],5:[function(a,b,c){function d(a,b){this.io=a,this.nsp=b,this.json=this,this.ids=0,this.acks={},this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.subEvents()}{var e=a("socket.io-parser"),f=a("component-emitter"),g=a("to-array"),h=a("./on"),i=a("component-bind"),j=a("debug")("socket.io-client:socket"),k=a("has-binary-data");a("indexof")}b.exports=c=d;var l={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},m=f.prototype.emit;f(d.prototype),d.prototype.subEvents=function(){var a=this.io;this.subs=[h(a,"open",i(this,"onopen")),h(a,"packet",i(this,"onpacket")),h(a,"close",i(this,"onclose"))]},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},d.prototype.send=function(){var a=g(arguments);return a.unshift("message"),this.emit.apply(this,a),this},d.prototype.emit=function(a){if(l.hasOwnProperty(a))return m.apply(this,arguments),this;var b=g(arguments),c=e.EVENT;k(b)&&(c=e.BINARY_EVENT);var d={type:c,data:b};return"function"==typeof b[b.length-1]&&(j("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++),this.connected?this.packet(d):this.sendBuffer.push(d),this},d.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},d.prototype.onopen=function(){j("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:e.CONNECT})},d.prototype.onclose=function(a){j("close (%s)",a),this.connected=!1,this.disconnected=!0,this.emit("disconnect",a)},d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:this.onevent(a);break;case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:this.onack(a);break;case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}},d.prototype.onevent=function(a){var b=a.data||[];j("emitting event %j",b),null!=a.id&&(j("attaching ack callback to event"),b.push(this.ack(a.id))),this.connected?m.apply(this,b):this.receiveBuffer.push(b)},d.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=g(arguments);j("sending ack %j",d);var f=k(d)?e.BINARY_ACK:e.ACK;b.packet({type:f,id:a,data:d})}}},d.prototype.onack=function(a){j("calling ack %s with %j",a.id,a.data);var b=this.acks[a.id];b.apply(this,a.data),delete this.acks[a.id]},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)m.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){j("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected?(j("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT}),this.destroy(),this.onclose("io client disconnect"),this):this}},{"./on":4,"component-bind":7,"component-emitter":8,debug:9,"has-binary-data":32,indexof:36,"socket.io-parser":40,"to-array":43}],6:[function(a,b){function c(a,b){var c=a,b=b||d.location;return null==a&&(a=b.protocol+"//"+b.hostname),"string"==typeof a&&("/"==a.charAt(0)&&"undefined"!=typeof b&&(a=b.hostname+a),/^(https?|wss?):\/\//.test(a)||(f("protocol-less url %s",a),a="undefined"!=typeof b?b.protocol+"//"+a:"https://"+a),f("parse %s",a),c=e(a)),c.port||(/^(http|ws)$/.test(c.protocol)?c.port="80":/^(http|ws)s$/.test(c.protocol)&&(c.port="443")),c.path=c.path||"/",c.id=c.protocol+"://"+c.host+":"+c.port,c.href=c.protocol+"://"+c.host+(b&&b.port==c.port?"":":"+c.port),c}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("parseuri"),f=a("debug")("socket.io-client:url");b.exports=c},{debug:9,parseuri:38}],7:[function(a,b){var c=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw new Error("bind() requires a function");var d=c.call(arguments,2);return function(){return b.apply(a,d.concat(c.call(arguments)))}}},{}],8:[function(a,b){function c(a){return a?d(a):void 0}function d(a){for(var b in c.prototype)a[b]=c.prototype[b];return a}b.exports=c,c.prototype.on=c.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},c.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},c.prototype.off=c.prototype.removeListener=c.prototype.removeAllListeners=c.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},c.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},c.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},c.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],9:[function(a,b){function c(a){return c.enabled(a)?function(b){b=d(b);var e=new Date,f=e-(c[a]||e);c[a]=e,b=a+" "+b+" +"+c.humanize(f),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function d(a){return a instanceof Error?a.stack||a.message:a}b.exports=c,c.names=[],c.skips=[],c.enable=function(a){try{localStorage.debug=a}catch(b){}for(var d=(a||"").split(/[\s,]+/),e=d.length,f=0;e>f;f++)a=d[f].replace("*",".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$"))},c.disable=function(){c.enable("")},c.humanize=function(a){var b=1e3,c=6e4,d=60*c;return a>=d?(a/d).toFixed(1)+"h":a>=c?(a/c).toFixed(1)+"m":a>=b?(a/b|0)+"s":a+"ms"},c.enabled=function(a){for(var b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(var b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1};try{window.localStorage&&c.enable(localStorage.debug)}catch(e){}},{}],10:[function(a,b){function c(a){return a?d(a):void 0}function d(a){for(var b in c.prototype)a[b]=c.prototype[b];return a}var e=a("indexof");b.exports=c,c.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},c.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},b._off=c,this.on(a,c),this},c.prototype.off=c.prototype.removeListener=c.prototype.removeAllListeners=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;var d=e(c,b._off||b);return~d&&c.splice(d,1),this},c.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},c.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},c.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{indexof:36}],11:[function(a,b){b.exports=a("./lib/")},{"./lib/":12}],12:[function(a,b){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":13,"engine.io-parser":22}],13:[function(a,b){function c(a,b){if(!(this instanceof c))return new c(a,b);if(b=b||{},a&&"object"==typeof a&&(b=a,a=null),a&&(a=k(a),b.host=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)),this.secure=null!=b.secure?b.secure:e.location&&"https:"==location.protocol,b.host){var d=b.host.split(":");b.hostname=d.shift(),d.length&&(b.port=d.pop())}this.agent=b.agent||!1,this.hostname=b.hostname||(e.location?location.hostname:"localhost"),this.port=b.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.forceBase64=!!b.forceBase64,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades}function d(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=c,c.priorWebsocketSuccess=!1,g(c.prototype),c.protocol=j.protocol,c.Socket=c,c.Transport=a("./transport"),c.transports=a("./transports"),c.parser=a("engine.io-parser"),c.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=d(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,forceBase64:this.forceBase64,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this});return c},c.prototype.open=function(){var a;a=this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket")?"websocket":this.transports[0],this.readyState="opening";var a=this.createTransport(a);a.open(),this.setTransport(a)},c.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},c.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data)h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),c.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&"closing"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())});else{h('probe transport "%s" failed',a);var d=new Error("probe error");d.transport=k.name,m.emit("upgradeError",d)}}))}function d(){l||(l=!0,j(),k.close(),k=null)}function e(b){var c=new Error("probe error: "+b);c.transport=k.name,d(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",c)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),d())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),l=!1,m=this;c.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},c.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},c.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing();break;case"error":var b=new Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},c.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},c.prototype.ping=function(){this.sendPacket("ping")},c.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},c.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},c.prototype.write=c.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},c.prototype.sendPacket=function(a,b,c){var d={type:a,data:b};this.emit("packetCreate",d),this.writeBuffer.push(d),this.callbackBuffer.push(c),this.flush()},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),h("socket closing - telling transport to close"),this.transport.close()),this},c.prototype.onError=function(a){h("socket error %j",a),c.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},c.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},c.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}},{"./transport":14,"./transports":15,"component-emitter":8,debug:9,"engine.io-parser":22,indexof:36,parsejson:29,parseqs:30,parseuri:38}],14:[function(a,b){function c(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket}var d=a("engine.io-parser"),e=a("component-emitter");b.exports=c,e(c.prototype),c.timestamps=0,c.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},c.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},c.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},c.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},c.prototype.onData=function(a){try{var b=d.decodePacket(a,this.socket.binaryType);this.onPacket(b)}catch(c){c.data=a,this.onError("parser decode error",c)}},c.prototype.onPacket=function(a){this.emit("packet",a)},c.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":8,"engine.io-parser":22}],15:[function(a,b,c){function d(a){var b,c=!1;if(e.location){var d="https:"==location.protocol,i=location.port;i||(i=d?443:80),c=a.hostname!=location.hostname||i!=a.port}return a.xdomain=c,b=new f(a),"open"in b&&!a.forceJSONP?new g(a):new h(a)}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("xmlhttprequest"),g=a("./polling-xhr"),h=a("./polling-jsonp"),i=a("./websocket");c.polling=d,c.websocket=i},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(a,b){function c(){}function d(a){f.call(this,a),this.query=this.query||{},h||(e.___eio||(e.___eio=[]),h=e.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=c)})}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("./polling"),g=a("component-inherit");b.exports=d;var h,i=/\n/g,j=/\\n/g;g(d,f),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),f.prototype.doClose.call(this)},d.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b;var d="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);d&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=k,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(j,"\\\n"),this.area.value=a.replace(i,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}},{"./polling":18,"component-inherit":21}],17:[function(a,b){function c(){}function d(a){if(i.call(this,a),g.location){var b="https:"==location.protocol,c=location.port;c||(c=b?443:80),this.xd=a.hostname!=g.location.hostname||c!=a.port}}function e(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.create(a.isBinary,a.supportsBinary)}function f(){for(var a in e.requests)e.requests.hasOwnProperty(a)&&e.requests[a].abort()}var g="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},h=a("xmlhttprequest"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=d,b.exports.Request=e,k(d,i),d.prototype.supportsBinary=!0,d.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,new e(a)},d.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},d.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(e.prototype),e.prototype.create=function(a,b){var c=this.xhr=new h({agent:this.agent,xdomain:this.xd}),d=this;try{if(l("xhr open %s: %s",this.method,this.uri),c.open(this.method,this.uri,this.async),b&&(c.responseType="arraybuffer"),"POST"==this.method)try{a?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(f){}"withCredentials"in c&&(c.withCredentials=!0),c.onreadystatechange=function(){var a;try{if(4!=c.readyState)return;if(200==c.status||1223==c.status){var e=c.getResponseHeader("Content-Type");a="application/octet-stream"===e?c.response:b?"ok":c.responseText}else setTimeout(function(){d.onError(c.status)},0)}catch(f){d.onError(f)}null!=a&&d.onData(a)},l("xhr data %s",this.data),c.send(this.data)}catch(f){return void setTimeout(function(){d.onError(f)},0)}g.document&&(this.index=e.requestsCount++,e.requests[this.index]=this)},e.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},e.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},e.prototype.onError=function(a){this.emit("error",a),this.cleanup()},e.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.xhr.onreadystatechange=c;try{this.xhr.abort()}catch(a){}g.document&&delete e.requests[this.index],this.xhr=null}},e.prototype.abort=function(){this.cleanup()},g.document&&(e.requestsCount=0,e.requests={},g.attachEvent?g.attachEvent("onunload",f):g.addEventListener&&g.addEventListener("beforeunload",f))},{"./polling":18,"component-emitter":8,"component-inherit":21,debug:9,xmlhttprequest:20}],18:[function(a,b){function c(a){var b=a&&a.forceBase64;(!i||b)&&(this.supportsBinary=!1),d.call(this,a)}var d=a("../transport"),e=a("parseqs"),f=a("engine.io-parser"),g=a("component-inherit"),h=a("debug")("engine.io-client:polling");b.exports=c;var i=function(){var b=a("xmlhttprequest"),c=new b({agent:this.agent,xdomain:!1});return null!=c.responseType}();g(c,d),c.prototype.name="polling",c.prototype.doOpen=function(){this.poll()},c.prototype.pause=function(a){function b(){h("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(h("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){h("pre-pause polling complete"),--d||b()})),this.writable||(h("we are currently writing - waiting to pause"),d++,this.once("drain",function(){h("pre-pause writing complete"),--d||b()}))}else b()},c.prototype.poll=function(){h("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},c.prototype.onData=function(a){var b=this;h("polling got data %s",a);var c=function(a){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)};f.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():h('ignoring poll - transport state "%s"',this.readyState))},c.prototype.doClose=function(){function a(){h("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(h("transport open - closing"),a()):(h("transport not open - deferring close"),this.once("open",a))},c.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;f.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},c.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";return!1!==this.timestampRequests&&(a[this.timestampParam]=+new Date+"-"+d.timestamps++),this.supportsBinary||a.sid||(a.b64=1),a=e.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a
}},{"../transport":14,"component-inherit":21,debug:9,"engine.io-parser":22,parseqs:30,xmlhttprequest:20}],19:[function(a,b){function c(a){var b=a&&a.forceBase64;b&&(this.supportsBinary=!1),d.call(this,a)}var d=a("../transport"),e=a("engine.io-parser"),f=a("parseqs"),g=a("component-inherit"),h=a("debug")("engine.io-client:websocket"),i=a("ws");b.exports=c,g(c,d),c.prototype.name="websocket",c.prototype.supportsBinary=!0,c.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent};this.ws=new i(a,b,c),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},c.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(c.prototype.onData=function(a){var b=this;setTimeout(function(){d.prototype.onData.call(b,a)},0)}),c.prototype.write=function(a){function b(){c.writable=!0,c.emit("drain")}var c=this;this.writable=!1;for(var d=0,f=a.length;f>d;d++)e.encodePacket(a[d],this.supportsBinary,function(a){try{c.ws.send(a)}catch(b){h("websocket closed before onclose event")}});setTimeout(b,0)},c.prototype.onClose=function(){d.prototype.onClose.call(this)},c.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},c.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=f.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},c.prototype.check=function(){return!(!i||"__initialize"in i&&this.name===c.prototype.name)}},{"../transport":14,"component-inherit":21,debug:9,"engine.io-parser":22,parseqs:30,ws:31}],20:[function(a,b){var c=a("has-cors");b.exports=function(a){var b=a.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!b||c))return new XMLHttpRequest}catch(d){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(d){}}},{"has-cors":34}],21:[function(a,b){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],22:[function(a,b,c){function d(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=o[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,d)},e.readAsArrayBuffer(a.data)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(n)return e(a,b,d);var f=new Uint8Array(1);f[0]=o[a.type];var g=new r([f.buffer,a.data]);return d(g)}function g(a,b,c){for(var d=new Array(a.length),e=l(a.length,c),f=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},g=0;g<a.length;g++)f(g,a[g],e)}var h="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},i=a("./keys"),j=a("arraybuffer.slice"),k=a("base64-arraybuffer"),l=a("after"),m=a("utf8"),n=navigator.userAgent.match(/Android/i);c.protocol=2;var o=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(o),q={type:"error",data:"parser error"},r=a("blob");c.encodePacket=function(a,b,c){"function"==typeof b&&(c=b,b=!1);var e=void 0===a.data?void 0:a.data.buffer||a.data;if(h.ArrayBuffer&&e instanceof ArrayBuffer)return d(a,b,c);if(r&&e instanceof h.Blob)return f(a,b,c);var g=o[a.type];return void 0!==a.data&&(g+=m.encode(String(a.data))),c(""+g)},c.encodeBase64Packet=function(a,b){var d="b"+c.packets[a.type];if(r&&a.data instanceof r){var e=new FileReader;return e.onload=function(){var a=e.result.split(",")[1];b(d+a)},e.readAsDataURL(a.data)}var f;try{f=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(g){for(var i=new Uint8Array(a.data),j=new Array(i.length),k=0;k<i.length;k++)j[k]=i[k];f=String.fromCharCode.apply(null,j)}return d+=h.btoa(f),b(d)},c.decodePacket=function(a,b){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);a=m.decode(a);var d=a.charAt(0);return Number(d)==d&&p[d]?a.length>1?{type:p[d],data:a.substring(1)}:{type:p[d]}:q}var e=new Uint8Array(a),d=e[0],f=j(a,1);return r&&"blob"===b&&(f=new r([f])),{type:p[d],data:f}},c.decodeBase64Packet=function(a,b){var c=p[a.charAt(0)];if(!h.ArrayBuffer)return{type:c,data:{base64:!0,data:a.substr(1)}};var d=k.decode(a.substr(1));return"blob"===b&&r&&(d=new r([d])),{type:c,data:d}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,b,function(a){d(null,e(a))})}return"function"==typeof b&&(d=b,b=null),b?r&&!n?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void g(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(q,0,1);for(var f,g,h="",i=0,j=a.length;j>i;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(q,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(q,0,1);if(g.length){if(e=c.decodePacket(g,b),q.type==e.type&&q.data==e.data)return d(q,0,1);var l=d(e,i+f,j);if(!1===l)return}i+=f,h=""}}return""!=h?d(q,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,function(a){return b(null,a)})}return a.length?void g(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}e[f++]=b?0:1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)}):b(new ArrayBuffer(0))},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,r){var i=new r([c.buffer,h.buffer,a]);b(null,i)}})}g(a,d,function(a,c){return b(new r(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[];e.byteLength>0;){for(var g=new Uint8Array(e),h=0===g[0],i="",k=1;255!=g[k];k++)i+=g[k];e=j(e,2+i.length),i=parseInt(i);var l=j(e,0,i);if(h)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(m){var n=new Uint8Array(l);l="";for(var k=0;k<n.length;k++)l+=String.fromCharCode(n[k])}f.push(l),e=j(e,i)}var o=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b),e,o)})}},{"./keys":23,after:24,"arraybuffer.slice":25,"base64-arraybuffer":26,blob:27,utf8:28}],23:[function(a,b){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],24:[function(a,b){function c(a,b,c){function e(a,d){if(e.count<=0)throw new Error("after called too many times");--e.count,a?(f=!0,b(a),b=c):0!==e.count||f||b(null,d)}var f=!1;return c=c||d,e.count=a,0===a?b():e}function d(){}b.exports=c},{}],25:[function(a,b){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(0>b&&(b+=d),0>c&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;c>g;g++,h++)f[h]=e[g];return f.buffer}},{}],26:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],27:[function(a,b){function c(a,b){b=b||{};for(var c=new e,d=0;d<a.length;d++)c.append(a[d]);return b.type?c.getBlob(b.type):c.getBlob()}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=d.BlobBuilder||d.WebKitBlobBuilder||d.MSBlobBuilder||d.MozBlobBuilder,f=function(){try{var a=new Blob(["hi"]);return 2==a.size}catch(b){return!1}}(),g=e&&e.prototype.append&&e.prototype.getBlob;b.exports=function(){return f?d.Blob:g?c:void 0}()},{}],28:[function(b,c,d){var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};!function(b){function f(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=t(b>>>10&1023|55296),b=56320|1023&b),e+=t(b);return e}function h(a,b){return t(a>>b&63|128)}function i(a){if(0==(4294967168&a))return t(a);var b="";return 0==(4294965248&a)?b=t(a>>6&31|192):0==(4294901760&a)?(b=t(a>>12&15|224),b+=h(a,6)):0==(4292870144&a)&&(b=t(a>>18&7|240),b+=h(a,12),b+=h(a,6)),b+=t(63&a|128)}function j(a){for(var b,c=f(a),d=c.length,e=-1,g="";++e<d;)b=c[e],g+=i(b);return g}function k(){if(s>=r)throw Error("Invalid byte index");var a=255&q[s];if(s++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function l(){var a,b,c,d,e;if(s>r)throw Error("Invalid byte index");if(s==r)return!1;if(a=255&q[s],s++,0==(128&a))return a;if(192==(224&a)){var b=k();if(e=(31&a)<<6|b,e>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=k(),c=k(),e=(15&a)<<12|b<<6|c,e>=2048)return e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=k(),c=k(),d=k(),e=(15&a)<<18|b<<12|c<<6|d,e>=65536&&1114111>=e))return e;throw Error("Invalid UTF-8 detected")}function m(a){q=f(a),r=q.length,s=0;for(var b,c=[];(b=l())!==!1;)c.push(b);return g(c)}var n="object"==typeof d&&d,o="object"==typeof c&&c&&c.exports==n&&c,p="object"==typeof e&&e;(p.global===p||p.window===p)&&(b=p);var q,r,s,t=String.fromCharCode,u={version:"2.0.0",encode:j,decode:m};if("function"==typeof a&&"object"==typeof a.amd&&a.amd)a(function(){return u});else if(n&&!n.nodeType)if(o)o.exports=u;else{var v={},w=v.hasOwnProperty;for(var x in u)w.call(u,x)&&(n[x]=u[x])}else b.utf8=u}(this)},{}],29:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},d=/^[\],:{}\s]*$/,e=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,f=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,h=/^\s+/,i=/\s+$/;b.exports=function(a){return"string"==typeof a&&a?(a=a.replace(h,"").replace(i,""),c.JSON&&JSON.parse?JSON.parse(a):d.test(a.replace(e,"@").replace(f,"]").replace(g,""))?new Function("return "+a)():void 0):null}},{}],30:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],31:[function(a,b){function c(a,b){var c;return c=b?new e(a,b):new e(a)}var d=function(){return this}(),e=d.WebSocket||d.MozWebSocket;b.exports=e?c:null,e&&(c.prototype=e.prototype)},{}],32:[function(a,b){function c(a){function b(a){if(!a)return!1;if(d.Buffer&&Buffer.isBuffer(a)||d.ArrayBuffer&&a instanceof ArrayBuffer||d.Blob&&a instanceof Blob||d.File&&a instanceof File)return!0;if(e(a)){for(var c=0;c<a.length;c++)if(b(a[c]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(b(a[f]))return!0}return!1}return b(a)}var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=a("isarray");b.exports=c},{isarray:33}],33:[function(a,b){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],34:[function(a,b){var c=a("global");try{b.exports="XMLHttpRequest"in c&&"withCredentials"in new c.XMLHttpRequest}catch(d){b.exports=!1}},{global:35}],35:[function(a,b){b.exports=function(){return this}()},{}],36:[function(a,b){var c=[].indexOf;b.exports=function(a,b){if(c)return a.indexOf(b);for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}},{}],37:[function(a,b,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},c.values=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(a[c]);return b},c.merge=function(a,b){for(var c in b)d.call(b,c)&&(a[c]=b[c]);return a},c.length=function(a){return c.keys(a).length},c.isEmpty=function(a){return 0==c.length(a)}},{}],38:[function(a,b){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){for(var b=c.exec(a||""),e={},f=14;f--;)e[d[f]]=b[f]||"";return e}},{}],39:[function(a,b,c){function d(a){return e.Buffer&&Buffer.isBuffer(a)||e.ArrayBuffer&&a instanceof ArrayBuffer}var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("isarray");c.deconstructPacket=function(a){function b(a){if(!a)return a;if(e.Buffer&&Buffer.isBuffer(a)||e.ArrayBuffer&&a instanceof ArrayBuffer){var d={_placeholder:!0,num:c.length};return c.push(a),d}if(f(a)){for(var g=new Array(a.length),h=0;h<a.length;h++)g[h]=b(a[h]);return g}if("object"==typeof a&&!(a instanceof Date)){var g={};for(var i in a)g[i]=b(a[i]);return g}return a}var c=[],d=a.data,g=a;return g.data=b(d),g.attachments=c.length,{packet:g,buffers:c}},c.reconstructPacket=function(a,b){function c(a){if(a&&a._placeholder){var d=b[a.num];return d}if(f(a)){for(var e=0;e<a.length;e++)a[e]=c(a[e]);return a}if(a&&"object"==typeof a){for(var g in a)a[g]=c(a[g]);return a}return a}return a.data=c(a.data),a.attachments=void 0,a},c.removeBlobs=function(a,b){function c(a,i,j){if(!a)return a;if(e.Blob&&a instanceof Blob||e.File&&a instanceof File){g++;var k=new FileReader;k.onload=function(){j?j[i]=this.result:h=this.result,--g||b(h)},k.readAsArrayBuffer(a)}if(f(a))for(var l=0;l<a.length;l++)c(a[l],l,a);else if(a&&"object"==typeof a&&!d(a))for(var m in a)c(a[m],m,a)}var g=0,h=a;c(h),g||b(h)}},{isarray:41}],40:[function(a,b,c){function d(){}function e(a){var b="",d=!1;return b+=a.type,(c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)&&(b+=a.attachments,b+="-"),a.nsp&&"/"!=a.nsp&&(d=!0,b+=a.nsp),null!=a.id&&(d&&(b+=",",d=!1),b+=a.id),null!=a.data&&(d&&(b+=","),b+=m.stringify(a.data)),l("encoded %j as %s",a,b),b}function f(a,b){function c(a){var c=o.deconstructPacket(a),d=e(c.packet),f=c.buffers;f.unshift(d),b(f)}o.removeBlobs(a,c)}function g(){this.reconstructor=null}function h(a){var b={},d=0;if(b.type=Number(a.charAt(0)),null==c.types[b.type])return j();if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type){for(b.attachments="";"-"!=a.charAt(++d);)b.attachments+=a.charAt(d);b.attachments=Number(b.attachments)}if("/"==a.charAt(d+1))for(b.nsp="";++d;){var e=a.charAt(d);if(","==e)break;if(b.nsp+=e,d+1==a.length)break}else b.nsp="/";var f=a.charAt(d+1);if(""!=f&&Number(f)==f){for(b.id="";++d;){var e=a.charAt(d);if(null==e||Number(e)!=e){--d;break}if(b.id+=a.charAt(d),d+1==a.length)break}b.id=Number(b.id)}if(a.charAt(++d))try{b.data=m.parse(a.substr(d))}catch(g){return j()}return l("decoded %s as %j",a,b),b}function i(a){this.reconPack=a,this.buffers=[]}function j(){return{type:c.ERROR,data:"parser error"}}var k="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},l=a("debug")("socket.io-parser"),m=a("json3"),n=(a("isarray"),a("emitter")),o=a("./binary");c.protocol=3,c.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=d,d.prototype.encode=function(a,b){if(l("encoding packet %j",a),c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)f(a,b);else{var d=e(a);b([d])}},c.Decoder=g,n(g.prototype),g.prototype.add=function(a){var b;if("string"==typeof a)b=h(a),c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=new i(b),0==this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b);else{if(!(k.Buffer&&Buffer.isBuffer(a)||k.ArrayBuffer&&a instanceof ArrayBuffer||a.base64))throw new Error("Unknown type: "+a);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");b=this.reconstructor.takeBinaryData(a),b&&(this.reconstructor=null,this.emit("decoded",b))}},g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},i.prototype.takeBinaryData=function(a){if(this.buffers.push(a),this.buffers.length==this.reconPack.attachments){var b=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null},i.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":39,debug:9,emitter:10,isarray:41,json3:42}],41:[function(a,b){b.exports=a(33)},{}],42:[function(b,c,d){!function(b){function c(a){if(c[a]!==g)return c[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=c("json-stringify")&&c("json-parse");else{var d,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var f=k.stringify,i="function"==typeof f&&l;if(i){(d=function(){return 1}).toJSON=d;try{i="0"===f(0)&&"0"===f(new Number)&&'""'==f(new String)&&f(h)===g&&f(g)===g&&f()===g&&"1"===f(d)&&"[1]"==f([d])&&"[null]"==f([g])&&"null"==f(null)&&"[null,null,null]"==f([g,h,null])&&f({a:[d,!0,!1,null,"\x00\b\n\f\r	"]})==e&&"1"===f(null,d)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(j){i=!1}}b=i}if("json-parse"==a){var m=k.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){d=m(e);var n=5==d.a.length&&1===d.a[0];if(n){try{n=!m('"	"')}catch(j){}if(n)try{n=1!==m("01")}catch(j){}if(n)try{n=1!==m("1.")}catch(j){}}}}catch(j){n=!1}b=n}}return c[a]=!!b}var e,f,g,h={}.toString,i="function"==typeof a&&a.amd,j="object"==typeof JSON&&JSON,k="object"==typeof d&&d&&!d.nodeType&&d;k&&j?(k.stringify=j.stringify,k.parse=j.parse):k=b.JSON=j||{};var l=new Date(-0xc782b5b800cec);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(m){}if(!c("json")){var n="[object Function]",o="[object Date]",p="[object Number]",q="[object String]",r="[object Array]",s="[object Boolean]",t=c("bug-string-char-index");if(!l)var u=Math.floor,v=[0,31,59,90,120,151,181,212,243,273,304,334],w=function(a,b){return v[b]+365*(a-1970)+u((a-1969+(b=+(b>1)))/4)-u((a-1901+b)/100)+u((a-1601+b)/400)};(e={}.hasOwnProperty)||(e=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=h?e=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,e=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,e.call(this,a)});var x={"boolean":1,number:1,string:1,undefined:1},y=function(a,b){var c=typeof a[b];return"object"==c?!!a[b]:!x[c]};if(f=function(a,b){var c,d,g,i=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(g in d)e.call(d,g)&&i++;return c=d=null,i?f=2==i?function(a,b){var c,d={},f=h.call(a)==n;for(c in a)f&&"prototype"==c||e.call(d,c)||!(d[c]=1)||!e.call(a,c)||b(c)}:function(a,b){var c,d,f=h.call(a)==n;for(c in a)f&&"prototype"==c||!e.call(a,c)||(d="constructor"===c)||b(c);(d||e.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(a,b){var c,f,g=h.call(a)==n,i=!g&&"function"!=typeof a.constructor&&y(a,"hasOwnProperty")?a.hasOwnProperty:e;for(c in a)g&&"prototype"==c||!i.call(a,c)||b(c);for(f=d.length;c=d[--f];i.call(a,c)&&b(c));}),f(a,b)},!c("json-stringify")){var z={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},A="000000",B=function(a,b){return(A+(b||0)).slice(-a)},C="\\u00",D=function(a){var b,c='"',d=0,e=a.length,f=e>10&&t;for(f&&(b=a.split(""));e>d;d++){var g=a.charCodeAt(d);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=z[g];break;default:if(32>g){c+=C+B(2,g.toString(16));break}c+=f?b[d]:t?a.charAt(d):a[d]}}return c+'"'},E=function(a,b,c,d,i,j,k){var l,m,n,t,v,x,y,z,A,C,F,G,H,I,J,K;try{l=b[a]}catch(L){}if("object"==typeof l&&l)if(m=h.call(l),m!=o||e.call(l,"toJSON"))"function"==typeof l.toJSON&&(m!=p&&m!=q&&m!=r||e.call(l,"toJSON"))&&(l=l.toJSON(a));else if(l>-1/0&&1/0>l){if(w){for(v=u(l/864e5),n=u(v/365.2425)+1970-1;w(n+1,0)<=v;n++);for(t=u((v-w(n,0))/30.42);w(n,t+1)<=v;t++);v=1+v-w(n,t),x=(l%864e5+864e5)%864e5,y=u(x/36e5)%24,z=u(x/6e4)%60,A=u(x/1e3)%60,C=x%1e3}else n=l.getUTCFullYear(),t=l.getUTCMonth(),v=l.getUTCDate(),y=l.getUTCHours(),z=l.getUTCMinutes(),A=l.getUTCSeconds(),C=l.getUTCMilliseconds();l=(0>=n||n>=1e4?(0>n?"-":"+")+B(6,0>n?-n:n):B(4,n))+"-"+B(2,t+1)+"-"+B(2,v)+"T"+B(2,y)+":"+B(2,z)+":"+B(2,A)+"."+B(3,C)+"Z"}else l=null;if(c&&(l=c.call(b,a,l)),null===l)return"null";if(m=h.call(l),m==s)return""+l;if(m==p)return l>-1/0&&1/0>l?""+l:"null";if(m==q)return D(""+l);if("object"==typeof l){for(I=k.length;I--;)if(k[I]===l)throw TypeError();if(k.push(l),F=[],J=j,j+=i,m==r){for(H=0,I=l.length;I>H;H++)G=E(H,l,c,d,i,j,k),F.push(G===g?"null":G);K=F.length?i?"[\n"+j+F.join(",\n"+j)+"\n"+J+"]":"["+F.join(",")+"]":"[]"}else f(d||l,function(a){var b=E(a,l,c,d,i,j,k);b!==g&&F.push(D(a)+":"+(i?" ":"")+b)}),K=F.length?i?"{\n"+j+F.join(",\n"+j)+"\n"+J+"}":"{"+F.join(",")+"}":"{}";return k.pop(),K}};k.stringify=function(a,b,c){var d,e,f,g;if("function"==typeof b||"object"==typeof b&&b)if((g=h.call(b))==n)e=b;else if(g==r){f={};for(var i,j=0,k=b.length;k>j;i=b[j++],g=h.call(i),(g==q||g==p)&&(f[i]=1));}if(c)if((g=h.call(c))==p){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else g==q&&(d=c.length<=10?c:c.slice(0,10));return E("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var F,G,H=String.fromCharCode,I={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},J=function(){throw F=G=null,SyntaxError()},K=function(){for(var a,b,c,d,e,f=G,g=f.length;g>F;)switch(e=f.charCodeAt(F)){case 9:case 10:case 13:case 32:F++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=t?f.charAt(F):f[F],F++,a;case 34:for(a="@",F++;g>F;)if(e=f.charCodeAt(F),32>e)J();else if(92==e)switch(e=f.charCodeAt(++F)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=I[e],F++;break;case 117:for(b=++F,c=F+4;c>F;F++)e=f.charCodeAt(F),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||J();a+=H("0x"+f.slice(b,F));break;default:J()}else{if(34==e)break;for(e=f.charCodeAt(F),b=F;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++F);a+=f.slice(b,F)}if(34==f.charCodeAt(F))return F++,a;J();default:if(b=F,45==e&&(d=!0,e=f.charCodeAt(++F)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(F+1),e>=48&&57>=e)&&J(),d=!1;g>F&&(e=f.charCodeAt(F),e>=48&&57>=e);F++);if(46==f.charCodeAt(F)){for(c=++F;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==F&&J(),F=c}if(e=f.charCodeAt(F),101==e||69==e){for(e=f.charCodeAt(++F),(43==e||45==e)&&F++,c=F;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==F&&J(),F=c}return+f.slice(b,F)}if(d&&J(),"true"==f.slice(F,F+4))return F+=4,!0;if("false"==f.slice(F,F+5))return F+=5,!1;if("null"==f.slice(F,F+4))return F+=4,null;J()}return"$"},L=function(a){var b,c;if("$"==a&&J(),"string"==typeof a){if("@"==(t?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=K(),"]"!=a;c||(c=!0))c&&(","==a?(a=K(),"]"==a&&J()):J()),","==a&&J(),b.push(L(a));return b}if("{"==a){for(b={};a=K(),"}"!=a;c||(c=!0))c&&(","==a?(a=K(),"}"==a&&J()):J()),(","==a||"string"!=typeof a||"@"!=(t?a.charAt(0):a[0])||":"!=K())&&J(),b[a.slice(1)]=L(K());return b}J()}return a},M=function(a,b,c){var d=N(a,b,c);d===g?delete a[b]:a[b]=d},N=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(h.call(e)==r)for(d=e.length;d--;)M(e,d,c);else f(e,function(a){M(e,a,c)});return c.call(a,b,e)};k.parse=function(a,b){var c,d;return F=0,G=""+a,c=L(K()),"$"!=K()&&J(),F=G=null,b&&h.call(b)==n?N((d={},d[""]=c,d),"",b):c}}}i&&a(function(){return k})}(this)},{}],43:[function(a,b){function c(a,b){var c=[];b=b||0;for(var d=b||0;d<a.length;d++)c[d-b]=a[d];return c}b.exports=c},{}]},{},[1])(1)}),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b){var c=[],d=[];return y(a,function(a){(b(a)?c:d).push(a)}),[c,d]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));
return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){{var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice}b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),function(a){var b,c,d=a.R,e=!1,f={init:function(a){a=a||typeof navigator!==c?navigator.language:"en-GB",b.locales={},b.navLang=a,e=!0},slice:function(a){return Array.prototype.slice.call(a)},AinOf:function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]===b)return c;return-1},realTypeOf:function(a){return Object.prototype.toString.call(a).match(/\w+/g)[1].toLowerCase()},render:function(a,c){return b.locales&&b.locales.hasOwnProperty(b.lang)&&b.locales[b.lang].hasOwnProperty(a)&&(a=b.locales[b.lang][a]),c&&0!==c.length?(c=f.parseVariables(c),f.format(a,c)):a},parseVariables:function(a,b){var c,d,e=f.realTypeOf(a);switch(b||(b={i:[],s:[],named:{}}),e){case"number":b.i.push(a);break;case"string":b.s.push(a);break;case"date":b.i.push(a.toString());break;case"object":for(c in a)a.hasOwnProperty(c)&&("i"===c||"s"===c?f.parseVariables(a[c],b):b.named[c]=a[c]);break;case"array":for(c=0,d=a.length;d>c;++c)f.parseVariables(a[c],b)}return b},format:function(a,b){var d,e,f,g,h,i,j={i:"%i",s:"%s"};for(h in j){if(j.hasOwnProperty(h))for(f=(a.match(new RegExp(j[h],"g"))||[]).length,d=0;f>d;++d)e=b[h].hasOwnProperty(d)?b[h][d]:e,e!==c&&e!==!1&&(g=a.indexOf(j[h]))>=0&&(a=a.substr(0,g)+e+a.substr(g+2));e=!1}for(d in b.named)b.named.hasOwnProperty(d)&&(i=new RegExp("%\\("+d+"\\)","g"),a=a.replace(i,b.named[d]));return a}};b=function(a,b){if(e||f.init(),arguments.length>1){var c=f.slice(arguments);return c.shift(),f.render(a,c)}return f.render(a,[b])},b.registerLocale=function(a,c){return e||f.init(),b.locales[a]=c,b.setLocale(b.navlang),b},b.localeOrder=function(){return b.preferredLocales=f.slice(arguments),b.setLocale(b.lang)},b.setLocale=function(a,c){if(e||f.init(),c)return b.lang=a,b;var d,g=b.preferredLocales;if(!g){g=[];for(d in b.locales)b.locales.hasOwnProperty(d)&&g.push(d)}return(d=f.AinOf(g,a))>0?(b.lang=g[d],b):(b.lang=g[0]||a,b)},b.noConflict=function(){return a.R=d,b},a.R=b}("undefined"!=typeof module&&module.exports?module.exports:this);var i18n={init:function(){R.registerLocale("en-US",{}),R.registerLocale("hu",{"Next unread":"Kv. olvasatlan",Edit:"Szerkeszts","All read":"Mindet olvasott","Leave conversation":"Kilps","{{ usercount }} participants":"{{ usercount }} rsztvev","Press Return to send, Shift-Return to break line.":"Nyomj Entert a mentshez, Shift-Entert a sortrshez.","Save message":"zenet mentse","Earlier messages":"Rgebbi zenetek","Add message":"j zenet","new messages":"j zenet","Reply to {{ user.name }}'s message":"Vlasz {{ user.name }} zenetre",Cancel:"Mgse",Close:"Bezrs","You have no conversations.":"Nincs aktv beszlgetsed","Add conversation":"j beszlgets","Add conversation +":"j beszlgets +",Title:"Beszlgets cme",Participants:"Rsztvevk",Create:"Ltrehozs","Sign out":"Kijelentkezs","Edit conversation":"Beszlgets szerkesztse",Save:"Ments","Searching...":"Keress...","User not found.":"Nincs ilyen felhasznlnk.","Enter username.":"rj be egy felhasznlnevet.","Do you want to leave conversation {{ title }}?\n\nIf you want to come back later, participants can invite you":"Biztosan kilpsz a kvetkez beszlgetsbl: {{ title }}?\n\nHa ksbb vissza szeretnl lpni, a beszlgets rsztvevi jra meghvhatnak.","Get invite code":"Meghv ignyls","Invite URL":"Meghv URL","Edit profile":"Profil",Name:"Nv",Avatar:"Avatr",Disconnected:"Megszakadt a kapcsolat","You're disconnected":"Megszakadt a kapcsolat","Retrying in:":"jracsatlakozs:",Reconnect:"jracsatlakozs most","{{ participantName }} mentioned you in {{ waveName }}!":"{{ participantName }} emlegetette a neved itt: {{ waveName }}!"}),R.setLocale(navigator.language||navigator.browserLanguage),i18n.translateTemplates(),i18n.applyR($("body"))},applyR:function(a){$(".R",a).each(function(){var a=$(this);a.prop("placeholder")&&a.prop("placeholder",R(a.prop("placeholder"))),a.html(R(a.html())).removeClass("R")})},translateTemplates:function(){var a,b,c,d,e=document.getElementsByTagName("script");for(a=0,b=e.length;b>a;a++)c=e[a],c&&c.innerHTML&&c.id&&("text/html"===c.type||"text/x-icanhaz"===c.type)&&(d=$(c.innerHTML),i18n.applyR(d),c.innerHTML=$("<div>").append(d).html())},__:function(a){return R(a)}};i18n.init();var __=i18n.__;!function(a){function b(a){return String(null===a||void 0===a?"":a)}function c(a){return b(a).replace(i,function(a){return h[a]})}var d={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(a){var b=a[this.propertyToSearch];return"<li>"+(this.enableHTML?b:c(b))+"</li>"},tokenFormatter:function(a){var b=a[this.propertyToSearch];return"<li><p>"+(this.enableHTML?b:c(b))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},e={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},f={BEFORE:0,AFTER:1,END:2},g={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i=/[&<>"'\/]/g,j={init:function(b,c){var e=a.extend({},d,c||{});
return this.each(function(){a(this).data("settings",e),a(this).data("tokenInputObject",new a.TokenList(this,b,e))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(a){return this.data("tokenInputObject").add(a),this},remove:function(a){return this.data("tokenInputObject").remove(a),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(a){return this.data("tokenInputObject").toggleDisabled(a),this},setOptions:function(b){return a(this).data("settings",a.extend({},a(this).data("settings"),b||{})),this}};a.fn.tokenInput=function(a){return j[a]?j[a].apply(this,Array.prototype.slice.call(arguments,1)):j.init.apply(this,arguments)},a.TokenList=function(b,d){function h(d){return a(b).data("settings").enableHTML?d:c(d)}function i(c){a(b).data("settings").disabled="boolean"==typeof c?c:!a(b).data("settings").disabled,N.attr("disabled",a(b).data("settings").disabled),S.toggleClass(a(b).data("settings").classes.disabled,a(b).data("settings").disabled),P&&p(a(P),f.END),O.attr("disabled",a(b).data("settings").disabled)}function j(){return null!==a(b).data("settings").tokenLimit&&L>=a(b).data("settings").tokenLimit?(N.hide(),void t()):void 0}function k(){J!==(J=N.val())&&(V.html(c(J)),N.width(V.width()+30))}function l(){var c=a.trim(N.val()),d=c.split(a(b).data("settings").tokenDelimiter);a.each(d,function(c,d){if(d){a.isFunction(a(b).data("settings").onFreeTaggingAdd)&&(d=a(b).data("settings").onFreeTaggingAdd.call(O,d));var e={};e[a(b).data("settings").tokenValue]=e[a(b).data("settings").propertyToSearch]=d,n(e)}})}function m(c){var d=a(a(b).data("settings").tokenFormatter(c)),e=c.readonly===!0?!0:!1;e&&d.addClass(a(b).data("settings").classes.tokenReadOnly),d.addClass(a(b).data("settings").classes.token).insertBefore(T),e||a("<span>"+a(b).data("settings").deleteText+"</span>").addClass(a(b).data("settings").classes.tokenDelete).appendTo(d).click(function(){return a(b).data("settings").disabled?void 0:(r(a(this).parent()),O.change(),!1)});var f=c;return a.data(d.get(0),"tokeninput",c),K=K.slice(0,Q).concat([f]).concat(K.slice(Q)),Q++,s(K,O),L+=1,null!==a(b).data("settings").tokenLimit&&L>=a(b).data("settings").tokenLimit&&(N.hide(),t()),d}function n(c){var d=a(b).data("settings").onAdd;if(L>0&&a(b).data("settings").preventDuplicates){var e=null;if(S.children().each(function(){var b=a(this),d=a.data(b.get(0),"tokeninput");return d&&d.id===c.id?(e=b,!1):void 0}),e)return o(e),T.insertAfter(e),void G(N)}(null==a(b).data("settings").tokenLimit||L<a(b).data("settings").tokenLimit)&&(m(c),j()),N.val(""),t(),a.isFunction(d)&&d.call(O,c)}function o(c){a(b).data("settings").disabled||(c.addClass(a(b).data("settings").classes.selectedToken),P=c.get(0),N.val(""),t())}function p(c,d){c.removeClass(a(b).data("settings").classes.selectedToken),P=null,d===f.BEFORE?(T.insertBefore(c),Q--):d===f.AFTER?(T.insertAfter(c),Q++):(T.appendTo(S),Q=L),G(N)}function q(b){var c=P;P&&p(a(P),f.END),c===b.get(0)?p(b,f.END):o(b)}function r(c){var d=a.data(c.get(0),"tokeninput"),e=a(b).data("settings").onDelete,f=c.prevAll().length;f>Q&&f--,c.remove(),P=null,G(N),K=K.slice(0,f).concat(K.slice(f+1)),Q>f&&Q--,s(K,O),L-=1,null!==a(b).data("settings").tokenLimit&&(N.show().val(""),G(N)),a.isFunction(e)&&e.call(O,d)}function s(c,d){var e=a.map(c,function(c){return"function"==typeof a(b).data("settings").tokenValue?a(b).data("settings").tokenValue.call(this,c):c[a(b).data("settings").tokenValue]});d.val(e.join(a(b).data("settings").tokenDelimiter))}function t(){U.hide().empty(),R=null}function u(){U.css({position:"absolute",top:a(S).offset().top+a(S).outerHeight(),left:a(S).offset().left,width:a(S).width(),"z-index":a(b).data("settings").zindex}).show()}function v(){a(b).data("settings").searchingText&&(U.html("<p>"+h(a(b).data("settings").searchingText)+"</p>"),u())}function w(){a(b).data("settings").hintText&&(U.html("<p>"+h(a(b).data("settings").hintText)+"</p>"),u())}function x(a){return a.replace(X,"\\$&")}function y(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+x(b)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(a,b){return"<b>"+h(b)+"</b>"})}function z(a,b,c){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+x(b)+")(?![^<>]*>)(?![^&;]+;)","g"),y(b,c))}function A(c,d){if(d&&d.length){U.empty();var e=a("<ul>").appendTo(U).mouseover(function(b){B(a(b.target).closest("li"))}).mousedown(function(b){return n(a(b.target).closest("li").data("tokeninput")),O.change(),!1}).hide();a(b).data("settings").resultsLimit&&d.length>a(b).data("settings").resultsLimit&&(d=d.slice(0,a(b).data("settings").resultsLimit)),a.each(d,function(d,f){var g=a(b).data("settings").resultsFormatter(f);g=z(g,f[a(b).data("settings").propertyToSearch],c),g=a(g).appendTo(e),g.addClass(d%2?a(b).data("settings").classes.dropdownItem:a(b).data("settings").classes.dropdownItem2),0===d&&B(g),a.data(g.get(0),"tokeninput",f)}),u(),a(b).data("settings").animateDropdown?e.slideDown("fast"):e.show()}else a(b).data("settings").noResultsText&&(U.html("<p>"+h(a(b).data("settings").noResultsText)+"</p>"),u())}function B(c){c&&(R&&C(a(R)),c.addClass(a(b).data("settings").classes.selectedDropdownItem),R=c.get(0))}function C(c){c.removeClass(a(b).data("settings").classes.selectedDropdownItem),R=null}function D(){var c=N.val();c&&c.length&&(P&&p(a(P),f.AFTER),c.length>=a(b).data("settings").minChars?(v(),clearTimeout(I),I=setTimeout(function(){E(c)},a(b).data("settings").searchDelay)):t())}function E(c){var d=c+F(),e=M.get(d);if(e)a.isFunction(a(b).data("settings").onCachedResult)&&(e=a(b).data("settings").onCachedResult.call(O,e)),A(c,e);else if(a(b).data("settings").url){var f=F(),g={};if(g.data={},f.indexOf("?")>-1){var h=f.split("?");g.url=h[0];var i=h[1].split("&");a.each(i,function(a,b){var c=b.split("=");g.data[c[0]]=c[1]})}else g.url=f;g.data[a(b).data("settings").queryParam]=c,g.type=a(b).data("settings").method,g.dataType=a(b).data("settings").contentType,a(b).data("settings").crossDomain&&(g.dataType="jsonp"),g.success=function(e){M.add(d,a(b).data("settings").jsonContainer?e[a(b).data("settings").jsonContainer]:e),a.isFunction(a(b).data("settings").onResult)&&(e=a(b).data("settings").onResult.call(O,e)),N.val()===c&&A(c,a(b).data("settings").jsonContainer?e[a(b).data("settings").jsonContainer]:e)},a.ajax(g)}else if(a(b).data("settings").local_data){var j=a.grep(a(b).data("settings").local_data,function(d){return d[a(b).data("settings").propertyToSearch].toLowerCase().indexOf(c.toLowerCase())>-1});M.add(d,j),a.isFunction(a(b).data("settings").onResult)&&(j=a(b).data("settings").onResult.call(O,j)),A(c,j)}}function F(){var c=a(b).data("settings").url;return"function"==typeof a(b).data("settings").url&&(c=a(b).data("settings").url.call(a(b).data("settings"))),c}function G(a){setTimeout(function(){a.focus()},50)}if("string"===a.type(d)||"function"===a.type(d)){a(b).data("settings").url=d;var H=F();void 0===a(b).data("settings").crossDomain&&"string"==typeof H&&(a(b).data("settings").crossDomain=-1===H.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==H.split(/\/+/g)[1])}else"object"==typeof d&&(a(b).data("settings").local_data=d);a(b).data("settings").classes?a(b).data("settings").classes=a.extend({},e,a(b).data("settings").classes):a(b).data("settings").theme?(a(b).data("settings").classes={},a.each(e,function(c,d){a(b).data("settings").classes[c]=d+"-"+a(b).data("settings").theme})):a(b).data("settings").classes=e;var I,J,K=[],L=0,M=new a.TokenList.Cache,N=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",a(b).data("settings").idPrefix+b.id).focus(function(){return a(b).data("settings").disabled?!1:((null===a(b).data("settings").tokenLimit||a(b).data("settings").tokenLimit!==L)&&w(),void S.addClass(a(b).data("settings").classes.focused))}).blur(function(){t(),a(this).val(""),S.removeClass(a(b).data("settings").classes.focused),a(b).data("settings").allowFreeTagging?l():a(this).val(""),S.removeClass(a(b).data("settings").classes.focused)}).bind("keyup keydown blur update",k).keydown(function(c){var d,e;switch(c.keyCode){case g.LEFT:case g.RIGHT:case g.UP:case g.DOWN:if(a(this).val()){var h=null;h=c.keyCode===g.DOWN||c.keyCode===g.RIGHT?a(R).next():a(R).prev(),h.length&&B(h)}else d=T.prev(),e=T.next(),d.length&&d.get(0)===P||e.length&&e.get(0)===P?c.keyCode===g.LEFT||c.keyCode===g.UP?p(a(P),f.BEFORE):p(a(P),f.AFTER):c.keyCode!==g.LEFT&&c.keyCode!==g.UP||!d.length?c.keyCode!==g.RIGHT&&c.keyCode!==g.DOWN||!e.length||o(a(e.get(0))):o(a(d.get(0)));return!1;case g.BACKSPACE:if(d=T.prev(),!a(this).val().length)return P?(r(a(P)),O.change()):d.length&&o(a(d.get(0))),!1;1===a(this).val().length?t():setTimeout(function(){D()},5);break;case g.TAB:case g.ENTER:case g.NUMPAD_ENTER:case g.COMMA:return R?(n(a(R).data("tokeninput")),O.change()):(a(b).data("settings").allowFreeTagging?l():a(this).val(""),c.stopPropagation(),c.preventDefault()),!1;case g.ESCAPE:return t(),!0;default:String.fromCharCode(c.which)&&setTimeout(function(){D()},5)}}),O=a(b).hide().val("").focus(function(){G(N)}).blur(function(){N.blur()}),P=null,Q=0,R=null,S=a("<ul />").addClass(a(b).data("settings").classes.tokenList).click(function(b){var c=a(b.target).closest("li");c&&c.get(0)&&a.data(c.get(0),"tokeninput")?q(c):(P&&p(a(P),f.END),G(N))}).mouseover(function(c){var d=a(c.target).closest("li");d&&P!==this&&d.addClass(a(b).data("settings").classes.highlightedToken)}).mouseout(function(c){var d=a(c.target).closest("li");d&&P!==this&&d.removeClass(a(b).data("settings").classes.highlightedToken)}).insertBefore(O),T=a("<li />").addClass(a(b).data("settings").classes.inputToken).appendTo(S).append(N),U=a("<div>").addClass(a(b).data("settings").classes.dropdown).appendTo("body").hide(),V=a("<tester/>").insertAfter(N).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:N.css("fontSize"),fontFamily:N.css("fontFamily"),fontWeight:N.css("fontWeight"),letterSpacing:N.css("letterSpacing"),whiteSpace:"nowrap"});O.val("");var W=a(b).data("settings").prePopulate||O.data("pre");a(b).data("settings").processPrePopulate&&a.isFunction(a(b).data("settings").onResult)&&(W=a(b).data("settings").onResult.call(O,W)),W&&W.length&&a.each(W,function(a,b){m(b),j()}),a(b).data("settings").disabled&&i(!0),a.isFunction(a(b).data("settings").onReady)&&a(b).data("settings").onReady.call(),this.clear=function(){S.children("li").each(function(){0===a(this).children("input").length&&r(a(this))})},this.add=function(a){n(a)},this.remove=function(b){S.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0;for(var e in b)if(b[e]!==c[e]){d=!1;break}d&&r(a(this))}})},this.getTokens=function(){return K},this.toggleDisabled=function(a){i(a)};var X=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},a.TokenList.Cache=function(b){var c=a.extend({max_size:500},b),d={},e=0,f=function(){d={},e=0};this.add=function(a,b){e>c.max_size&&f(),d[a]||(e+=1),d[a]=b},this.get=function(a){return d[a]}}}(jQuery);var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a},e=function(a){var b=new Date(a.getFullYear(),a.getMonth(),a.getDate());b.setDate(b.getDate()-(b.getDay()+6)%7+3);var c=new Date(b.getFullYear(),0,4);c.setDate(c.getDate()-(c.getDay()+6)%7+3);var d=b.getTimezoneOffset()-c.getTimezoneOffset();b.setHours(b.getHours()-d);var e=(b-c)/6048e5;return 1+Math.floor(e)},f=function(a){var b=a.getDay();return 0===b&&(b=7),b};return function(g,h,i,j){var k=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(g)||/\d/.test(g)||(h=g,g=void 0),g=g||new Date,g instanceof Date||(g=new Date(g)),isNaN(g))throw TypeError("Invalid date");h=String(k.masks[h]||h||k.masks["default"]);var l=h.slice(0,4);("UTC:"==l||"GMT:"==l)&&(h=h.slice(4),i=!0,"GMT:"==l&&(j=!0));var m=i?"getUTC":"get",n=g[m+"Date"](),o=g[m+"Day"](),p=g[m+"Month"](),q=g[m+"FullYear"](),r=g[m+"Hours"](),s=g[m+"Minutes"](),t=g[m+"Seconds"](),u=g[m+"Milliseconds"](),v=i?0:g.getTimezoneOffset(),w=e(g),x=f(g),y={d:n,dd:d(n),ddd:k.i18n.dayNames[o],dddd:k.i18n.dayNames[o+7],m:p+1,mm:d(p+1),mmm:k.i18n.monthNames[p],mmmm:k.i18n.monthNames[p+12],yy:String(q).slice(2),yyyy:q,h:r%12||12,hh:d(r%12||12),H:r,HH:d(r),M:s,MM:d(s),s:t,ss:d(t),l:d(u,3),L:d(Math.round(u/10)),t:12>r?"a":"p",tt:12>r?"am":"pm",T:12>r?"A":"P",TT:12>r?"AM":"PM",Z:j?"GMT":i?"UTC":(String(g).match(b)||[""]).pop().replace(c,""),o:(v>0?"-":"+")+d(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*n%10],W:w,N:x};return h.replace(a,function(a){return a in y?y[a]:a.slice(1,a.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},"undefined"!=typeof exports&&(module.exports=dateFormat);var randomName=function(){var a=["Aqua","Black","Blue","Fuchsia","Gray","Green","Lime","Maroon","Navy","Olive","Orange","Purple","Red","Silver","Teal","White","Yellow"],b=["Aardvark","Albatross","Alligator","Alpaca","Ant","Anteater","Antelope","Ape","Armadillo","Donkey","Baboon","Badger","Barracuda","Bat","Bear","Beaver","Bee","Bison","Boar","Buffalo","Butterfly","Camel","Capybara","Caribou","Cassowary","Cat","Caterpillar","Chamois","Cheetah","Chicken","Chimpanzee","Chinchilla","Chough","Clam","Cobra","Cockroach","Cod","Cormorant","Coyote","Crab","Crane","Crocodile","Crow","Curlew","Deer","Dinosaur","Dog","Dogfish","Dolphin","Dotterel","Dove","Dragonfly","Duck","Dugong","Dunlin","Eagle","Echidna","Eel","Eland","Elephant","Elk","Emu","Falcon","Ferret","Finch","Fish","Flamingo","Fly","Fox","Frog","Gaur","Gazelle","Gerbil","Giraffe","Gnat","Gnu","Goat","Goose","Goldfinch","Goldfish","Gorilla","Goshawk","Grasshopper","Grouse","Guanaco","Gull","Hamster","Hare","Hawk","Hedgehog","Heron","Herring","Hippopotamus","Hornet","Horse","Hummingbird","Hyena","Ibex","Ibis","Jackal","Jaguar","Jay","Jellyfish","Kangaroo","Kingfisher","Koala","Kookabura","Kouprey","Kudu","Lapwing","Lark","Lemur","Leopard","Lion","Llama","Lobster","Locust","Loris","Louse","Lyrebird","Magpie","Mallard","Manatee","Mandrill","Mantis","Marten","Meerkat","Mink","Mole","Mongoose","Monkey","Moose","Mouse","Mosquito","Mule","Narwhal","Newt","Nightingale","Octopus","Okapi","Opossum","Oryx","Ostrich","Otter","Owl","Ox","Oyster","Panther","Parrot","Partridge","Peafowl","Pelican","Penguin","Pheasant","Pig","Pigeon","Porcupine","Porpoise","Quail","Quelea","Quetzal","Rabbit","Raccoon","Rail","Ram","Rat","Raven","Reindeer","Rhinoceros","Rook","Salamander","Salmon","Sandpiper","Sardine","Scorpion","Seahorse","Seal","Shark","Sheep","Shrew","Skunk","Snail","Snake","Sparrow","Spider","Spoonbill","Squid","Squirrel","Starling","Stingray","Stinkbug","Stork","Swallow","Swan","Tapir","Tarsier","Termite","Tiger","Toad","Trout","Turkey","Turtle","Vicuna","Viper","Vulture","Wallaby","Walrus","Wasp","Weasel","Whale","Wolf","Wolverine","Wombat","Woodcock","Woodpecker","Worm","Wren","Yak","Zebra"];return function(){return a[Math.floor(Math.random()*a.length)]+b[Math.floor(Math.random()*b.length)]}}(),User=Backbone.Model.extend({defaults:{name:"",avatar:"",email:"",status:"offline"},idAttribute:"_id",update:function(a){_.each(a,function(a,b){this.idAttribute!==b&&this.set(b,a)},this)},chatInPrivateWaveWithUser:function(a){if(a!==this){var b=app.model.waves.filter(function(b){return 2===b.users.length&&b.users.contains(a)&&b.users.contains(this)},this);b.length?app.navigate("wave/"+b[0].id,{trigger:!0}):Communicator.createWave(randomName()+"Room",[a.id])}}}),UserCollection=Backbone.Collection.extend({model:User,getUser:function(a){var b=this.get(a);return void 0===b&&(b=new User({_id:a,name:"[loading]"}),this.add(b),Communicator.getUser(a)),b}}),Wave=Backbone.Model.extend({defaults:{title:"",userIds:[],current:!1},idAttribute:"_id",initialize:function(){if(this.messages=new MessageCollection,this.users=new UserCollection,this.get("userIds")){var a=this.get("userIds");this.addUsers(a)}},addMessage:function(a){if(null!==a.get("parentId")){var b,c,d=this.messages.get(a.get("parentId"));if(!d)return this.messages.length>0&&(b=a.get("parentId"),c=this.messages.at(0).id,Communicator.getMessages(this,b,c)),!1;d.addReply(a),this.messages.add(a)}else this.messages.add(a);return!0},addUser:function(a){this.users.add(a)},addUsers:function(a){_.each(a,function(a){var b=app.model.users.get(a);this.addUser(b)},this)},getUnreadCount:function(){return this.messages.reduce(function(a,b){return a+(b.get("unread")?1:0)},0)},getUserNames:function(){return this.users.pluck("name").join(", ")},getUserCount:function(){return this.users.length},update:function(a){this.set("title",a.title);var b,c,d=this.get("userIds");a.userIds!==d&&(c=_.difference(a.userIds,d),b=_.difference(d,a.userIds),this.users.remove(b),this.addUsers(c),this.set("userIds",a.userIds))},setCurrentMessage:function(a){this.currentMessageId=a},getNextUnreadMessage:function(){var a,b,c,d,e=0;if(this.currentMessageId){if(d=this.messages.get(this.currentMessageId),e=d.getSortableId(),a=d.getNextUnread(e,!1,[]))return a;e=d.getRootId()}for(b=this.messages.filter(function(a){return a.getSortableId()>e&&null===a.get("parentId")}),c=0;c<b.length;c++)if(a=b[c].getNextUnread(e,!0,[]))return a;if(e>0)for(b=this.messages.filter(function(a){return a.getSortableId()<e&&null===a.get("parentId")}),c=0;c<b.length;c++)if(a=b[c].getNextUnread(0,!0,[]))return a;return a||this.trigger("noMoreUnread"),a},getPreviousMessages:function(){if(this.messages.length){var a=this.messages.at(0).id;Communicator.getMessages(this,null,a)}},readAllMessages:function(){var a=!1;this.messages.each(function(b){a=b.readAllMessages()||a}),a&&(this.trigger("readAll"),Communicator.readAllMessages(this))},quit:function(){Communicator.quitUser(this.id),app.currentWaveId=null,app.model.waves.remove(this),app.model.messages.remove(app.model.messages.where({waveId:this.id}),{silent:!0}),app.showLastWave()}}),WaveCollection=Backbone.Collection.extend({model:Wave}),Message=Backbone.Model.extend({defaults:{userId:null,waveId:null,parentId:null,message:"",unread:!0,created_at:null},idAttribute:"_id",initialize:function(){this.messages=null,this.user=app.model.users.getUser(this.get("userId")),this.formatMessage(),this.isNew()||this.set("unread",this.get("unread")&&app.model.currentUser.id!==this.get("userId"))},addReply:function(a){null===this.messages&&(this.messages=new MessageCollection,this.trigger("messagesCreated")),this.messages.add(a)},read:function(){this.get("unread")&&(this.set("unread",!1),Communicator.readMessage(this))},setCurrent:function(){this.getWave().setCurrentMessage(this.id)},setScrolled:function(){this.trigger("change:scrolled")},formatMessage:function(){var a,b,c,d,e,f,g=this.get("message"),h=/((https?:\/\/|www\.)[^\s"]+)/g;for(g=strip_tags(g),a=g.split(" "),b=0,c=a.length;c>b;b++)d=a[b].match(h),d?(e=f=d[0],f=f.length>53?f.substr(0,50)+"...":f,e="http"===e.substr(0,4)?e:"http://"+e,a[b]=a[b].replace(d[0],'<a href="'+e+'" target="_blank">'+f+"</a>")):a[b]=wordwrap(a[b],200," ",!0);g=a.join(" "),g=nl2br(g,!0),this.set("messageFormatted",g)},getSortableId:function(){if(!this.sortableId)if(this.id.toString().length>8){var a=Number("0x"+this.id.substr(0,8)),b=Number("0x"+this.id.substr(18,6));this.sortableId=a+b%1e3/1e3}else this.sortableId=this.id.toString();return this.sortableId},readAllMessages:function(){var a=this.get("unread");return this.set({unread:!1},{silent:!0}),a},getNextUnread:function(a,b,c){if(_.indexOf(c,this.getSortableId())>-1)return null;if(c.push(this.getSortableId()),this.getSortableId()>a&&this.get("unread"))return this;var d,e=this.messages?this.messages.toArray():[],f=null;for(d=0;d<e.length;d++)if(f=e[d].getNextUnread(a,!0,c))return f;return f||!this.get("parentId")||b?f:app.model.messages.get(this.get("parentId")).getNextUnread(0,!1,c)},getRootId:function(){return this.get("parentId")?app.model.messages.get(this.get("parentId")).getRootId():this.getSortableId()},getWave:function(){return app.model.waves.get(this.get("waveId"))},isCurrentUserMentioned:function(){if(this.get("unread")){var a="@"+app.model.currentUser.get("name");return this.get("message").indexOf(a)>=0}return!1}}),MessageCollection=Backbone.Collection.extend({model:Message,comparator:function(a){return a.getSortableId()}}),SurfAppModel=Backbone.Model.extend({initialize:function(){this.waves=new WaveCollection,this.users=new UserCollection,this.messages=new MessageCollection,this.currentUser=null},initCurrentUser:function(a){this.currentUser=a,this.trigger("initCurrentUser")}}),UserView=Backbone.View.extend({initialize:function(){_.bindAll(this,"render","update","chatInPrivate"),this.model.bind("change",this.update)},events:{dblclick:"chatInPrivate"},render:function(){var a=_.template($("#user_view").text(),this.model.toJSON());return this.setElement(a),this.$el.attr("src",this.model.get("avatar")),this},update:function(){return this.$el.removeClass("online offline").addClass(this.model.get("status")),this.$el.attr("title",this.model.get("name")),this.$el.attr("alt",this.model.get("name")),this.$el.attr("src")!==this.model.get("avatar")&&this.$el.attr("src",this.model.get("avatar")),this},chatInPrivate:function(){app.model.currentUser.chatInPrivateWaveWithUser(this.model)}}),WaveListView=Backbone.View.extend({initialize:function(){_.bindAll(this,"setCurrent","countMessages","updateMessages","changeUsers","updateTitle","scrollToNextUnread","removeWave"),this.model.bind("change:current",this.setCurrent),this.model.bind("change:title",this.updateTitle),this.model.bind("remove",this.removeWave),this.model.messages.bind("change:unread",this.countMessages),this.model.bind("readAll",this.countMessages),this.model.messages.bind("add",this.countMessages),this.model.messages.bind("add",this.updateMessages),this.model.users.bind("add",this.changeUsers),this.model.users.bind("remove",this.changeUsers)},events:{click:"scrollToNextUnread"},render:function(){var a=_.extend(this.model.toJSON(),{id:this.model.id}),b=_.template($("#wave_list_view").text(),a);return this.setElement(b),this.changeUsers(),this},setCurrent:function(){this.model.get("current")&&($(".waveitem").removeClass("open"),this.$el.addClass("open"))},countMessages:function(){var a=this.model.getUnreadCount();a>0?this.$el.find(".piros").text("| "+a+" "+__("new messages")):(this.$el.find(".piros").text(""),this.$el.removeClass("updated"))},updateMessages:function(a){a.get("userId")!==app.model.currentUser.id&&a.get("unread")&&this.$el.addClass("updated")},changeUsers:function(){var a=__("{{ usercount }} participants").replace("{{ usercount }}",this.model.getUserCount());this.$el.find(".usercount").text(a)},updateTitle:function(){this.$el.find("h2").text(this.model.get("title"))},scrollToNextUnread:function(a){if(app.currentWaveId===this.model.id){a.preventDefault();var b=this.model.getNextUnreadMessage();b&&b.setScrolled()}},removeWave:function(a){a.id===this.model.id&&this.$el.remove()}}),WaveView=Backbone.View.extend({initialize:function(){_.bindAll(this,"setCurrent","addMessage","addUser","removeUser","updateTitle","showUpdateWave","scrollToNextUnread","scrollToBottom","readAllMessages","quitWave","removeWave","countOfflineUsers","readAll"),this.userViews=[],this.model.bind("change:current",this.setCurrent),this.model.bind("change:title",this.updateTitle),this.model.bind("noMoreUnread",this.scrollToBottom),this.model.bind("remove",this.removeWave),this.model.bind("readAll",this.readAll),this.model.bind("scrollToNextUnread",this.scrollToNextUnread),this.model.messages.bind("add",this.addMessage),this.model.users.bind("add",this.addUser),this.model.users.bind("remove",this.removeUser),this.model.users.bind("change",this.countOfflineUsers)},events:{"click a.editwave":"showUpdateWave","click a.gounread":"scrollToNextUnread","click a.getprevmessages":"getPreviousMessages","click a.readall":"readAllMessages","click a.quit":"quitWave"},render:function(){var a=_.extend(this.model.toJSON(),{id:this.model.id}),b=_.template($("#wave_view").text(),a),c=new WaveReplyFormView({model:this.model});return this.setElement(b),this.$el.hide(),c.render().$el.appendTo(this.$el.find(".waves-container")),this.model.users.each(this.addUser),this},setCurrent:function(){this.model.get("current")&&($(".wave").hide(),this.$el.show(),this.scrollToNextUnread())},addMessage:function(a){if(null===a.get("parentId")){var b=new MessageView({model:a}),c=this.model.messages.where({parentId:null}).indexOf(a),d=b.render().el;0===c?this.$el.find("div.getprevmessages").after(d):this.$el.find(".messages > .message").eq(c-1).after(d)}},changeUsers:function(){var a=this.model.getUserNames();this.$el.find("span.usernames").text(a)},addUser:function(a){this.changeUsers();var b=new UserView({model:a});this.userViews[a.id]=b,this.$el.find(".heads").append(b.render().el),this.countOfflineUsers()},removeUser:function(a){this.changeUsers(),this.userViews[a.id].remove(),delete this.userViews[a.id],this.countOfflineUsers()},countOfflineUsers:function(){var a=this.$el.find(".offline-list"),b=this.model.users.where({status:"offline"}).length;b>0?(a.find(".count").text(b),a.show()):a.hide()},updateTitle:function(){this.$el.find("h2").text(this.model.get("title"))},showUpdateWave:function(){return app.view.showUpdateWave()},scrollToNextUnread:function(a){ga("send","event","WaveView","scrollToNextUnread"),a&&a.preventDefault();var b=this.model.getNextUnreadMessage();b&&b.setScrolled()},scrollToBottom:function(){var a=this.$el.find(".waves-container");a.scrollTop(a.prop("scrollHeight")).focus()},getPreviousMessages:function(a){a.preventDefault(),ga("send","event","WaveView","getPreviousMessages"),this.model.getPreviousMessages()},readAllMessages:function(a){ga("send","event","WaveView","readAllMessages"),a.preventDefault(),this.model.readAllMessages()},quitWave:function(a){ga("send","event","WaveView","quitWave"),a.preventDefault();var b=__("Do you want to leave conversation {{ title }}?\n\nIf you want to come back later, participants can invite you").replace("{{ title }}",this.model.get("title"));confirm(b)&&this.model.quit()},removeWave:function(a){a.id===this.model.id&&this.$el.remove()},readAll:function(){this.$el.find("table.unread").removeClass("unread")}}),MessageView=Backbone.View.extend({initialize:function(){this.hasReplyForm=!1,_.bindAll(this,"addMessage","readMessage","replyMessage","onReadMessage","scrollTo","changeUserName"),this.model.bind("messagesCreated",function(){this.model.messages.bind("add",this.addMessage)},this),this.model.bind("change:unread",this.onReadMessage),this.model.bind("change:scrolled",this.scrollTo),this.model.user.bind("change:name",this.changeUserName);var a=new Date(this.model.get("created_at"));this.model.set("dateFormatted",dateFormat(a,"mmm d HH:MM"))},events:{click:"readMessage",dblclick:"replyMessage","click a.reply":"replyMessage","click a.threadend":"replyMessage"},render:function(){var a=_.extend(this.model.toJSON(),{id:this.model.id,user:this.model.user.toJSON()}),b=_.template($("#message_view").text(),a),c=new UserView({model:this.model.user});return this.setElement(b),this.model.get("unread")||this.$el.children("table").removeClass("unread"),this.$el.find(".message-header").html(c.render().el),this.$el.children("div.threadend").hide(),this.model.isCurrentUserMentioned()&&this.mention(),this},addMessage:function(a){var b=new MessageView({model:a});this.$el.children(".replies").append(b.render().el),1===this.model.messages.length&&0===this.$el.children("div.replyform").size()&&this.$el.children("div.threadend").show()},readMessage:function(a){a.stopPropagation(),this.model.read(),this.model.setCurrent()},onReadMessage:function(){this.model.get("unread")||this.$el.children("table").removeClass("unread")},scrollTo:function(){var a=this.$el.position().top,b=this.$el.parents(".waves-container");this.$el.triggerHandler("click"),(0>a||a>b.height())&&b.scrollTop(this.$el.position().top+b.scrollTop()-.3*b.height()),this.$el.children("table").focus()},replyMessage:function(a){a.preventDefault();var b,c=this.$el.find("> div:last-child").hasClass("replyform");return this.model.getWave().trigger("hideReplyForm"),c?!1:(b=new MessageReplyFormView({model:this.model}),b.render(),$("body").hasClass("mobile")?b.$el.find("form").submit():b.show(this.$el),!1)},changeUserName:function(){this.$el.find("span.author").eq(0).text(this.model.user.get("name")+":")},mention:function(){if(window.Notification){var a,b=this,c=__("{{ participantName }} mentioned you in {{ waveName }}!").replace("{{ participantName }}",this.model.user.get("name")).replace("{{ waveName }}",this.model.getWave().get("title"));"granted"===Notification.permission?a=new Notification(c,{tag:"mentionNotification",icon:"/images/surf-ico.png"}):"denied"!==Notification.permission&&Notification.requestPermission(function(b){"granted"===b&&(a=new Notification(c,{tag:"mentionNotification",icon:"/images/surf-ico.png"}))}),a&&(a.onclick=function(){b.model.setScrolled()},a.onshow=function(){setTimeout(a.close.bind(a),5e3)})}}}),WaveReplyFormView=Backbone.View.extend({initialize:function(){_.bindAll(this,"submitForm","handleKeydown")},events:{"submit form":"submitForm","keydown textarea":"handleKeydown"},render:function(){var a=_.template($("#wavereplyform_view").text());return this.setElement(a()),this},submitForm:function(a){a.preventDefault();var b=this.$el.find("textarea");return $("body").hasClass("mobile")&&0===b.val().length&&b.val(prompt(b.prop("placeholder"))),b.val().length>0&&Communicator.sendMessage(b.val(),this.getWaveId(),this.getParentId()),b.val(""),!1},handleKeydown:function(a){a.shiftKey||13!==a.keyCode?32===a.keyCode&&" "===$(a.target).val()?(a.preventDefault(),this.scrollToNextUnread()):a.shiftKey||9!==a.keyCode||(a.preventDefault(),this.mentionUser()):(a.preventDefault(),this.$el.find("form").submit()),a.stopPropagation()},scrollToNextUnread:function(){this.model.trigger("scrollToNextUnread")},getWaveId:function(){return this.model.id},getWave:function(){return app.model.waves.get(this.getWaveId())},getParentId:function(){return null},mentionUser:function(){var a,b,c,d=0,e=this.$el.find("textarea"),f=e[0].selectionEnd||0,g=e.val().lastIndexOf("@",f);if(g>-1&&50>f-g&&(a=e.val().substring(g+1,f).toLowerCase(),b=this.getWave().users.filter(function(b){return 0===b.get("name").toLowerCase().indexOf(a)}),b.length>0)){if(1===b.length)c=b[0].get("name");else{for(c=b[0].get("name").substr(0,a.length);_.all(b,function(a){return a.get("name").substr(0,c.length)===c});)c=b[0].get("name").substr(0,c.length+1);c=c.substr(0,c.length-1)+"?",d=1}e.val(e.val().substring(0,g+1)+c+e.val().substr(f)),e[0].selectionStart=g+1+c.length-d,e[0].selectionEnd=g+1+c.length}}}),MessageReplyFormView=WaveReplyFormView.extend({events:_.extend({"click a.cancel":"handleCancel"},WaveReplyFormView.prototype.events),initialize:function(){WaveReplyFormView.prototype.initialize.apply(this,arguments),this.timeout=75,_.bindAll(this,"handleCancel","hide"),this.model.getWave().bind("hideReplyForm",this.hide)},render:function(){var a=_.template($("#messagereplyform_view").text(),{user:this.model.user.toJSON()});
return this.setElement(a),this},handleCancel:function(a){return a.preventDefault(),this.hide(),!1},scrollToNextUnread:function(){this.model.getWave().trigger("scrollToNextUnread")},getWaveId:function(){return this.model.get("waveId")},getParentId:function(){return this.model.id},show:function(a){var b=a.children("div.threadend");b.is(":visible")?(b.hide(),this.$el.height(b.height()).appendTo(a).animate({height:"145px"},this.timeout,function(){$(this).find("textarea").focus()})):this.$el.hide().appendTo(a).slideDown(this.timeout,function(){$(this).find("textarea").focus()})},hide:function(){var a,b=this;this.$el.siblings(".replies").children().size()>0?(a=this.$el.siblings(".threadend"),this.$el.animate({height:a.height()},this.timeout,function(){a.show(),b.remove()})):this.$el.slideUp(this.timeout,function(){b.remove()})}}),EditWaveView=Backbone.View.extend({initialize:function(){_.bindAll(this,"show","hide","setWave","genUserArray","inviteCodeReady"),this.userArray=[],this.model.users.bind("add",this.genUserArray,this),this.model.users.bind("change",this.genUserArray,this)},events:{"click a.close":"hide","submit form":"editWave","click button#editwave-invite":"getInviteCode"},render:function(){var a=_.template($("#editwave_view").text(),{});return this.setElement(a),this.$el.hide(),this},genUserArray:function(){this.userArray=this.model.users.reduce(function(a,b){var c={id:b.id,name:b.get("name")+" ("+b.get("email")+")"};return(!this.wave||this.wave&&!this.wave.users.get(b.id))&&a.push(c),a},[],this)},initUserSuggest:function(){this.genUserArray(),this.inited||(this.$el.find("#editwave-users").tokenInput([],{theme:"facebook",preventDuplicates:!0,hintText:__("Enter username."),noResultsText:__("User not found."),searchingText:__("Searching...")}),this.inited=!0)},updateUserSuggest:function(){this.initUserSuggest(),$("#editwave-users").data("settings").local_data=this.userArray;var a=this.$el.find("#editwave-users");a.tokenInput("clear"),this.wave?this.wave.users.each(function(b){a.tokenInput("add",{id:b.id,name:b.get("name"),readonly:!0})}):a.tokenInput("add",{id:app.model.currentUser.id,name:app.model.currentUser.get("name"),readonly:!0})},show:function(){return ga("send","event","EditWaveView","show"),this.$el.find("#editwave-invitecode-block").hide(),this.wave?(this.$el.find("input[name=title]").val(this.wave.get("title")),this.$el.find("h2").text(__("Edit conversation")),this.$el.find("#editwave-submit").text(__("Save")),this.$el.find("#editwave-invite").show()):(this.$el.find("input[name=title]").val(""),this.$el.find("h2").text(__("Add conversation")),this.$el.find("#editwave-submit").text(__("Create")),this.$el.find("#editwave-invite").hide()),this.updateUserSuggest(),this.$el.show(),$("#darken").show(),!1},hide:function(){return this.$el.hide(),$("#darken").hide(),!1},setWave:function(a){this.wave=this.model.waves.get(a),this.wave&&this.wave.bind("inviteCodeReady",this.inviteCodeReady,this)},editWave:function(){var a=this.$el.find("#editwave-title").val(),b=this.$el.find("#editwave-users").tokenInput("get"),c=_.pluck(b,"id");return this.wave?Communicator.updateWave(this.wave.id,a,c):Communicator.createWave(a,c),this.hide()},getInviteCode:function(a){ga("send","event","EditWaveView","getInviteCode"),a.preventDefault(),this.$el.find("button#editwave-invite").hide(),Communicator.getInviteCode(this.wave.id)},inviteCodeReady:function(a){this.$el.find("#editwave-invitecode-block").show();var b=document.location.protocol+"//"+document.location.host+"/invite/"+a;this.$el.find("#editwave-invitecode").val(b).focus().select()}}),EditUserView=Backbone.View.extend({initialize:function(){_.bindAll(this,"show","hide"),this.model.bind("change",this.updateFields,this)},events:{"click a.close":"hide","submit form":"saveUser"},render:function(){var a=_.template($("#edituser_view").text(),{});return this.setElement(a),this.$el.hide(),this.updateFields(),this},updateFields:function(){this.$el.find("#edituser-name").val(this.model.get("name")),this.$el.find("#edituser-avatar").val(this.model.get("avatar")),this.$el.find("div.avatar").remove();var a="https://secure.gravatar.com/avatar/"+this.model.get("emailMD5")+"?s=80&d=monsterid";this.model.get("googleAvatar")&&this.addAvatarOption(this.model.get("googleAvatar")),this.model.get("facebookAvatar")&&this.addAvatarOption(this.model.get("facebookAvatar")),this.addAvatarOption(a)},addAvatarOption:function(a){var b=$(_.template($("#edituser_avatar_view").text(),{url:a}));b.find("img").prop("src",a),a===this.model.get("avatar")&&b.find("input").prop("checked",!0),this.$el.find(".ediutuser-avatar-row .right").append(b)},show:function(){return this.$el.show(),$("#darken").show(),!1},hide:function(){return this.$el.hide(),$("#darken").hide(),!1},saveUser:function(a){a.preventDefault();var b=this.$el.find("#edituser-name").val(),c=this.$el.find("input[name=edituser-avatar-cb]:checked").val();return Communicator.updateUser(b,c),this.hide()}}),DisconnectedView=Backbone.View.extend({initialize:function(){_.bindAll(this,"show"),this.counterStart=3,this.counter=this.counterStart},render:function(){var a=_.template($("#disconnected_view").text(),{counter:this.counter});return this.setElement(a),this.$el.hide(),this},show:function(){if(ga("send","event","DisconnectedView","show","connection",this.model.reconnect?1:0),this.model.reconnect){var a=this;this.interval=setInterval(function(){a.count()},1e3)}else this.$el.find(".countdown").hide();return this.$el.show(),$("#darken").show(),!1},count:function(){if(this.counter--,this.counter>0)this.$el.find(".counter").text(this.counter);else{var a=this;clearInterval(a.interval),$.ajax("images/surf-ico.png?"+Math.random(),{timeout:900}).fail(function(){a.counterStart*=2,a.counter=a.counterStart,a.interval=setInterval(function(){a.count()},1e3)}).success(function(){document.location.href="/"})}}}),SurfAppView=Backbone.View.extend({initialize:function(){_.bindAll(this,"addMessage","showCreateWave","showUpdateWave","showEditUser","hideOverlays","addWave"),this.model.waves.bind("add",this.addWave,this),this.model.waves.bind("reset",this.resetWaves,this),this.model.waves.bind("remove",this.handleEmpty),this.model.messages.bind("reset",this.resetMessages,this),this.model.messages.bind("add",this.setTitle,this),this.model.messages.bind("change:unread",this.setTitle,this),this.model.waves.bind("readAll",this.setTitle,this),this.model.bind("initCurrentUser",this.initCurrentUser,this),this.render()},events:{"click a.addwave":"showCreateWave","click a.edituser":"showEditUser","click #darken":"hideOverlays"},render:function(){this.setElement($("body")),this.editWaveView=new EditWaveView({model:this.model}),this.$el.append(this.editWaveView.render().el),this.iconImage=new Image;var a=this;return this.iconImage.onload=function(){a.setTitle()},this.iconImage.src="images/surf-ico.png",$(".empty").hide(),$("body").keydown(function(a){var b=$(a.target).prop("nodeName");"INPUT"!==b&&"TEXTAREA"!==b&&32===a.keyCode&&(a.preventDefault(),app.currentWaveId&&(document.activeElement.blur(),app.model.waves.get(app.currentWaveId).trigger("scrollToNextUnread")))}),$(window).resize(function(){$(window).width()<1e3?$("body").addClass("mobile"):$("body").removeClass("mobile")}).trigger("resize"),this},addWave:function(a){var b=new WaveListView({model:a}),c=new WaveView({model:a});this.handleEmpty(),$("#wave-list").append(b.render().el),$("#wave-container").append(c.render().el)},resetWaves:function(){this.model.waves.map(this.addWave,this)},addMessage:function(a){var b=this.model.waves.get(a.get("waveId"));b&&b.addMessage(a)},resetMessages:function(){this.model.messages.map(this.addMessage),this.setTitle()},showCreateWave:function(){return this.editWaveView.setWave(null),this.editWaveView.show(),!1},showUpdateWave:function(){return this.editWaveView.setWave(app.model.waves.get(app.currentWaveId)),this.editWaveView.show(),!1},showEditUser:function(){return this.editUserView&&this.editUserView.show(),!1},showDisconnected:function(a){this.disconnectedView=new DisconnectedView({model:{reconnect:a}}),this.$el.append(this.disconnectedView.render().el),this.disconnectedView.show()},hideOverlays:function(){return _.isUndefined(this.disconnectedView)&&($("#darken").hide(),$(".overlay").hide()),!1},initCurrentUser:function(){var a=new UserView({model:this.model.currentUser});return this.$el.find("#currentuser").html("").append(a.render().el).append(' <p class="currentuser_name">'+this.model.currentUser.escape("name")+"</p>"),this.model.currentUser.bind("change:name",this.changeCurrentUserName,this),this.editUserView=new EditUserView({model:this.model.currentUser}),this.$el.append(this.editUserView.render().el),!1},changeCurrentUserName:function(){return this.$el.find("p.currentuser_name").text(this.model.currentUser.escape("name")),!1},setTitle:function(){var a="Surf",b=this.model.messages.where({unread:!0}).length;b>0&&(a="["+b+"] "+a),$("title").text(a),this.setIcon(b)},setIcon:function(a){if(this.iconImage.complete)try{var b,c,d,e=document.createElement("canvas");e.width=35,e.height=35,b=e.getContext("2d"),b.drawImage(this.iconImage,0,0),a>0&&(b.fillStyle="#444444",b.font="bold 16px sans-serif",c=a>99?"99+":a.toString(),b.fillText(c,35-9*c.length,35)),d=document.createElement("link"),d.type="image/x-icon",d.rel="shortcut icon",d.href=e.toDataURL("image/x-icon"),$('link[rel="shortcut icon"]').remove(),$("head").append(d)}catch(f){return f}},handleEmpty:function(){0===app.model.waves.length?$(".empty").show():$(".empty").hide()}}),Communicator={socket:null,reconnect:!0,pingTimeout:null,createTitle:null,initialize:function(){if(void 0!==window.io){var a=this;this.socket=new io.connect(document.location.href,{reconnect:!1}),this.socket.on("init",function(b){a.onInit(b)}),this.socket.on("message",function(b){a.onMessage(b)}),this.socket.on("disconnect",function(){clearTimeout(a.pingTimeout),app.view.showDisconnected(a.reconnect)}),this.socket.on("updateUser",this.onUpdateUser),this.socket.on("updateWave",function(b){a.onUpdateWave(b)}),this.socket.on("inviteCodeReady",this.onInviteCodeReady),this.socket.on("dontReconnect",function(){a.reconnect=!1}),this.socket.on("pong",function(){a.schedulePing()})}},onInit:function(a){if(null===app.model.currentUser){a.users.push(a.me),app.model.users.reset(a.users),app.model.initCurrentUser(app.model.users.get(a.me._id)),app.model.waves.reset(a.waves),app.model.messages.reset(a.messages);var b=app.model.messages.last();b&&app.navigate("wave/"+b.get("waveId"),{trigger:!0}),this.schedulePing()}},sendMessage:function(a,b,c){var d={userId:app.model.currentUser.id,waveId:b,message:a,parentId:c};this.socket.emit("message",d)},readMessage:function(a){this.socket.emit("readMessage",{id:a.id,waveId:a.get("waveId")})},readAllMessages:function(a){this.socket.emit("readAllMessages",{waveId:a.id})},createWave:function(a,b){var c={title:a,userIds:b};this.createTitle=a,this.socket.emit("createWave",c)},updateWave:function(a,b,c){var d={id:a,title:b,userIds:c};this.socket.emit("updateWave",d)},onMessage:function(a){if(this.schedulePing(),a.messages)return void _.each(a.messages,function(a){this.onMessage(a)},this);var b=new Message(a);app.model.waves.get(a.waveId).addMessage(b)&&app.model.messages.add(b)},onUpdateUser:function(a){var b=a.user;app.model.users.get(b._id)?app.model.users.get(b._id).update(b):app.model.users.add(new User(b))},onUpdateWave:function(a){var b,c=a.wave;app.model.waves.get(c._id)?app.model.waves.get(c._id).update(c):(b=new Wave(c),app.model.waves.add(b),(1===app.model.waves.length||this.createTitle===b.get("title"))&&app.navigate("wave/"+b.id,{trigger:!0}))},getMessages:function(a,b,c){var d={waveId:a.id,minParentId:b,maxRootId:c};this.socket.emit("getMessages",d)},getUser:function(a){var b={userId:a};this.socket.emit("getUser",b)},quitUser:function(a){var b={waveId:a};this.socket.emit("quitWave",b)},getInviteCode:function(a){var b={waveId:a};this.socket.emit("createInviteCode",b)},onInviteCodeReady:function(a){app.model.waves.get(a.waveId)&&app.model.waves.get(a.waveId).trigger("inviteCodeReady",a.code)},schedulePing:function(){var a=this;clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(function(){a.socket.emit("ping")},3e4)},updateUser:function(a,b){var c={name:a,avatar:b};this.socket.emit("updateUser",c)}},SurfAppRouter=Backbone.Router.extend({defaults:{currentWaveId:null},initialize:function(){this.model=new SurfAppModel,this.view=new SurfAppView({model:this.model})},routes:{"wave/:number":"showWave"},showWave:function(a){this.model.waves.get(a)?(this.currentWaveId&&this.model.waves.get(this.currentWaveId).set("current",!1),this.model.waves.get(a).set("current",!0),this.currentWaveId=a):this.model.waves.length?this.showLastWave():this.navigate("/")},showLastWave:function(){var a,b;a=this.model.messages.last(),a?this.navigate("wave/"+a.get("waveId"),{trigger:!0}):(b=this.model.waves.last(),this.showWave(b?b.id:null))}});window.onerror=function(a,b,c){var d={prefix:"JSERROR",errorMessage:a+" in "+b+" on line "+c+". URL: "+window.location.href+" BROWSER: "+navigator.userAgent};$.post("/logError",d)},$(function(){_.templateSettings={interpolate:/\{|\|(.+?)\|\}/g,escape:/\{\{(.+?)\}\}/g};var a=new SurfAppRouter;window.app=a,Backbone.history.start(),Communicator.initialize()});